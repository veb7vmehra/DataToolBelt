{% extends "base.html" %}

{% block input %}

<script src="http://d3js.org/d3.v3.min.js"></script>
<br>
Filename = {{filename}}<br>
Attributes = {{n_col}}<br>
Entities = {{n_row}}<br>

<script>
    function deleteSame(){
        var filename = '{{filename}}';
    var n = filename.split('.');
    var extension = n[1];
    console.log(extension);
    for(i = 1; i <= 4; i++){
        if(document.getElementById("option"+i.toString()) == extension){
            var element = document.getElementById("option"+i);
            element.parentNode.removeChild(element);   
        }
     }
    }
    
</script>

<form action="" method="POST" enctype="multipart/form-data">
    <label for="head">Convert to:</label>
    <select id="head" name = "head">
        <script>deleteSame();</script>
        <option id="option1">json</option>
        <option id="option2">csv</option>
        <option id="option3">xml</option>
        <option id="option4">nc</option>
    </select>
    <input type="button" value="Convert and Download">

</form>

<script>
    function getVal(){
        var value = $.ajax({
            type:"GET",
            dataType: "json",
            data:{'filename':'{{lists}}','feature':$('#header1').val(),'func':$("#functions").val()},
            url: "/stat",
            success: function(data){
                buf1=data;
                console.log(data);
                $("#output").val(data)
            }
        })
    }
</script>

<script type="text/javascript"charset="utf-8">
    d3.text('{{lists}}', function(data) {
        var parsedCSV = d3.csv.parseRows(data);

        var container = d3.select("#table_container")
            .append("table")

            .selectAll("tr")
                .data(parsedCSV).enter()
                .append("tr")

            .selectAll("td")
                .data(function(d) { return d; }).enter()
                .append("td")
                .text(function(d) { return d; });
    });
</script>
<div id="table_container" style="overflow-y: auto;padding: 2%;DISPLAY: INLINE-BLOCK;margin: 0;text-align: center;width: 80%;max-height: 300px;"></div>
<div id="table_container" style="width: fit-content; display: inline-block; padding: 4%;">
    <table>
        <tr>
            {% for c in col %} 
            <td>{{c}}</td>       
            {% endfor %}
        </tr>
        <tr>
            {% for type in types %} 
            <td>{{type}}</td>       
            {% endfor %}
        </tr>
    </table>
</div>
<form action="" method="POST" enctype="multipart/form-data">
    <label for="header1">Choose a feature:</label>
    <select id="header1" name="header1">

        {% for c in col %} 
        <option value='{{c}}'>{{c}}</option>       
        {% endfor %}

    </select>
    <label for="features">Choose a function:</label>
    <select id="functions" name="functions">
        <option value="max">Maximum</option>
        <option value="min">Minimum</option>
        <option value="mean">Mean (average)</option>
        <option value="sum">Sum</option>
    </select>
    <input type="button" value="Submit" onclick="getVal()">
    <input id=output disabled></input>

</form>
{% endblock %}